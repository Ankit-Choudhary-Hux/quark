File(Import(Name(quark)), CompilerVersionSpec(),

 Package(Name(quark),

  Class(Name(ServletError), Type(Name(Error)),

   Method(static=False, Type(Name(String)), Name(_getClass), Block(
     Return(String("quark.ServletError", $type=1.quark.String)))),

   Method(static=False, Type(Name(Object)), Name(_getField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("message", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ServletError), Name(message),
        $type=1.quark.String)))),
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(void)), Name(_setField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("message", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ServletError), Name(message),
        $type=1.quark.String), Cast(Var(Name(value), $type=1.quark.Object),
        $type=1.quark.String)))))),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_ServletError_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_ServletError_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Interface(Annotation(Name(doc), String("A service addresable with an url",
    $type=1.quark.String)), Name(Servlet),

   Method(static=False, Annotation(Name(doc),
     String("called after the servlet is successfully installed. The url will be the actual url used, important especially if ephemeral port was requested",
     $type=1.quark.String)), Type(Name(void)), Name(onServletInit),
    Param(Type(Name(String)), Name(url), $type=1.quark.String),
    Param(Type(Name(Runtime)), Name(runtime), $type=0.quark.Runtime),
    Block()),

   Method(static=False, Annotation(Name(doc),
     String("called if the servlet could not be installed",
     $type=1.quark.String)), Type(Name(void)), Name(onServletError),
    Param(Type(Name(String)), Name(url), $type=1.quark.String),
    Param(Type(Name(ServletError)), Name(error), $type=5.quark.ServletError),
    Block()),

   Method(static=False, Annotation(Name(doc),
     String("called when the servlet is removed", $type=1.quark.String)),
    Type(Name(void)), Name(onServletEnd),
    Param(Type(Name(String)), Name(url), $type=1.quark.String),
    Block()),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_Servlet_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_Servlet_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Interface(Name(Resolver),

   Method(static=False, Type(Name(List), Type(Name(String))), Name(resolve),
    Param(Type(Name(String)), Name(serviceName), $type=1.quark.String)),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_Resolver_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_Resolver_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Class(Name(ResponseHolder), Type(Name(HTTPHandler)),
   Field(static=False, Type(Name(HTTPResponse)), Name(response),
   $type=7.quark.HTTPResponse),
   Field(static=False, Type(Name(HTTPError)), Name(failure), Null(null,
    $type=1.quark.Object), $type=7.quark.HTTPError),

   Method(static=False, Type(Name(void)), Name(onHTTPResponse),
    Param(Type(Name(HTTPRequest)), Name(request), $type=7.quark.HTTPRequest),
    Param(Type(Name(HTTPResponse)), Name(response),
    $type=7.quark.HTTPResponse),
    Block(
     Assign(Attr(Var(Name(self), $type=5.quark.ResponseHolder), Name(response),
      $type=7.quark.HTTPResponse), Var(Name(response),
      $type=7.quark.HTTPResponse)))),

   Method(static=False, Type(Name(void)), Name(onHTTPError),
    Param(Type(Name(HTTPRequest)), Name(request), $type=7.quark.HTTPRequest),
    Param(Type(Name(HTTPError)), Name(error), $type=7.quark.HTTPError),
    Block(
     Assign(Var(Name(failure), $type=7.quark.HTTPError), Var(Name(error),
      $type=7.quark.HTTPError)))),

   Method(static=False, Type(Name(String)), Name(_getClass), Block(
     Return(String("quark.ResponseHolder", $type=1.quark.String)))),

   Method(static=False, Type(Name(Object)), Name(_getField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("response", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ResponseHolder),
         Name(response), $type=7.quark.HTTPResponse)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("failure", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ResponseHolder),
         Name(failure), $type=7.quark.HTTPError)))),
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(void)), Name(_setField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("response", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ResponseHolder),
         Name(response), $type=7.quark.HTTPResponse), Cast(Var(Name(value),
         $type=1.quark.Object), $type=7.quark.HTTPResponse)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("failure", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ResponseHolder),
         Name(failure), $type=7.quark.HTTPError), Cast(Var(Name(value),
         $type=1.quark.Object), $type=7.quark.HTTPError)))))),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_ResponseHolder_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_ResponseHolder_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Interface(Name(Service),

   Method(static=False, Type(Name(String)), Name(getName)),

   Method(static=False, Type(Name(ServiceInstance)), Name(getInstance)),

   Method(static=False, Type(Name(float)), Name(getTimeout)),

   Method(static=False, Type(Name(concurrent), Name(Future)), Name(rpc),
    Param(Type(Name(String)), Name(methodName), $type=1.quark.String),
    Param(Type(Name(List), Type(Name(Object))), Name(args),
    $type=1.quark.List<1.quark.Object>),
    Block(
     Local(
      Declaration(Type(Name(behaviors), Name(RPC)), Name(rpc),
       Call(Type(Name(behaviors), Name(RPC)), Var(Name(self),
        $type=5.quark.Service), Var(Name(methodName), $type=1.quark.String),
       $type=5.quark.behaviors.RPC), $type=5.quark.behaviors.RPC)),
     Return(Call(Attr(Var(Name(rpc), $type=5.quark.behaviors.RPC), Name(call),
       $type=5.quark.behaviors.RPC.call), Var(Name(args),
       $type=1.quark.List<1.quark.Object>),
      $type=6.quark.concurrent.Future)))),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_Service_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_Service_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Class(Name(BaseService), Type(Name(Service)),

   Method(static=False, Type(Name(String)), Name(getName), Block(
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(ServiceInstance)), Name(getInstance), Block(
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(float)), Name(getTimeout), Block(
     Return(Call(Attr(Number(1.0, $type=1.quark.float), Name(__neg__),
       $type=1.quark.numeric.__neg__), $type=1.quark.float)))),

   Method(static=False, Type(Name(String)), Name(_getClass), Block(
     Return(String("quark.BaseService", $type=1.quark.String)))),

   Method(static=False, Type(Name(Object)), Name(_getField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Block(
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(void)), Name(_setField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
    Block()),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_BaseService_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_BaseService_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Class(Name(ServiceInstance),
   Field(static=False, Type(Name(String)), Name(serviceName),
   $type=1.quark.String),
   Field(static=False, Type(Name(String)), Name(url), $type=1.quark.String),
   Field(static=False, Type(Name(behaviors), Name(CircuitBreaker)),
    Name(breaker), $type=5.quark.behaviors.CircuitBreaker),

   Constructor(Name(ServiceInstance),
    Param(Type(Name(String)), Name(serviceName), $type=1.quark.String),
    Param(Type(Name(String)), Name(url), $type=1.quark.String),
    Param(Type(Name(int)), Name(failureLimit), $type=1.quark.int),
    Param(Type(Name(float)), Name(retestDelay), $type=1.quark.float),
    Block(
     Assign(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
       Name(serviceName), $type=1.quark.String), Var(Name(serviceName),
      $type=1.quark.String)),
     Assign(Attr(Var(Name(self), $type=5.quark.ServiceInstance), Name(url),
      $type=1.quark.String), Var(Name(url), $type=1.quark.String)),
     Assign(Attr(Var(Name(self), $type=5.quark.ServiceInstance), Name(breaker),
      $type=5.quark.behaviors.CircuitBreaker), Call(Type(Name(behaviors),
        Name(CircuitBreaker)),
       Call(Attr(Call(Attr(Call(Attr(Call(Attr(String("[",
               $type=1.quark.String), Name(__add__),
              $type=1.quark.String.__add__), Var(Name(serviceName),
              $type=1.quark.String), $type=1.quark.String), Name(__add__),
            $type=1.quark.String.__add__), String(" at ",
            $type=1.quark.String), $type=1.quark.String), Name(__add__),
          $type=1.quark.String.__add__), Var(Name(url), $type=1.quark.String),
         $type=1.quark.String), Name(__add__), $type=1.quark.String.__add__),
        String("]", $type=1.quark.String), $type=1.quark.String),
       Var(Name(failureLimit), $type=1.quark.int), Var(Name(retestDelay),
       $type=1.quark.float), $type=5.quark.behaviors.CircuitBreaker)))),

   Method(static=False, Type(Name(bool)), Name(isActive), Block(
     Return(Attr(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
        Name(breaker), $type=5.quark.behaviors.CircuitBreaker), Name(active),
      $type=1.quark.bool)))),

   Method(static=False, Type(Name(String)), Name(getURL), Block(
     Return(Attr(Var(Name(self), $type=5.quark.ServiceInstance), Name(url),
      $type=1.quark.String)))),

   Method(static=False, Type(Name(void)), Name(succeed),
    Param(Type(Name(String)), Name(info), $type=1.quark.String),
    Block(
     If(Call(Attr(Call(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
          Name(isActive), $type=5.quark.ServiceInstance.isActive),
        $type=1.quark.bool), Name(__not__), $type=1.quark.bool.__not__),
      $type=1.quark.bool), Block(
       ExprStmt(Call(Attr(Attr(Var(Name(Client), $type=5.quark.Client),
           Name(logger), $type=2.quark.Logger), Name(info),
         $type=2.quark.Logger.info),
         Call(Attr(Call(Attr(Call(Attr(String("- CLOSE breaker for ",
               $type=1.quark.String), Name(__add__),
              $type=1.quark.String.__add__), Attr(Var(Name(self),
               $type=5.quark.ServiceInstance), Name(serviceName),
              $type=1.quark.String), $type=1.quark.String), Name(__add__),
            $type=1.quark.String.__add__), String(" at ",
            $type=1.quark.String), $type=1.quark.String), Name(__add__),
          $type=1.quark.String.__add__), Attr(Var(Name(self),
           $type=5.quark.ServiceInstance), Name(url), $type=1.quark.String),
         $type=1.quark.String), $type=1.quark.void)))),
     ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
         Name(breaker), $type=5.quark.behaviors.CircuitBreaker), Name(succeed),
       $type=5.quark.behaviors.CircuitBreaker.succeed), $type=1.quark.void)))),

   Method(static=False, Type(Name(void)), Name(fail),
    Param(Type(Name(String)), Name(info), $type=1.quark.String),
    Block(
     If(Call(Attr(Call(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
          Name(isActive), $type=5.quark.ServiceInstance.isActive),
        $type=1.quark.bool), Name(__not__), $type=1.quark.bool.__not__),
      $type=1.quark.bool), Block(
       ExprStmt(Call(Attr(Attr(Var(Name(Client), $type=5.quark.Client),
           Name(logger), $type=2.quark.Logger), Name(warn),
         $type=2.quark.Logger.warn),
         Call(Attr(Call(Attr(Call(Attr(String("- OPEN breaker for ",
               $type=1.quark.String), Name(__add__),
              $type=1.quark.String.__add__), Attr(Var(Name(self),
               $type=5.quark.ServiceInstance), Name(serviceName),
              $type=1.quark.String), $type=1.quark.String), Name(__add__),
            $type=1.quark.String.__add__), String(" at ",
            $type=1.quark.String), $type=1.quark.String), Name(__add__),
          $type=1.quark.String.__add__), Attr(Var(Name(self),
           $type=5.quark.ServiceInstance), Name(url), $type=1.quark.String),
         $type=1.quark.String), $type=1.quark.void)))),
     ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
         Name(breaker), $type=5.quark.behaviors.CircuitBreaker), Name(fail),
       $type=5.quark.behaviors.CircuitBreaker.fail), $type=1.quark.void)))),

   Method(static=False, Type(Name(String)), Name(_getClass), Block(
     Return(String("quark.ServiceInstance", $type=1.quark.String)))),

   Method(static=False, Type(Name(Object)), Name(_getField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("serviceName",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
         Name(serviceName), $type=1.quark.String)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("url", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ServiceInstance), Name(url),
        $type=1.quark.String)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("breaker", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
         Name(breaker), $type=5.quark.behaviors.CircuitBreaker)))),
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(void)), Name(_setField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("serviceName",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
         Name(serviceName), $type=1.quark.String), Cast(Var(Name(value),
         $type=1.quark.Object), $type=1.quark.String)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("url", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ServiceInstance), Name(url),
        $type=1.quark.String), Cast(Var(Name(value), $type=1.quark.Object),
        $type=1.quark.String)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("breaker", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ServiceInstance),
         Name(breaker), $type=5.quark.behaviors.CircuitBreaker),
        Cast(Var(Name(value), $type=1.quark.Object),
        $type=5.quark.behaviors.CircuitBreaker)))))),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_ServiceInstance_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_ServiceInstance_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Class(Annotation(Name(doc),
    String("DegenerateResolver assumes that the serviceName is an URL.",
    $type=1.quark.String)), Name(DegenerateResolver), Type(Name(Resolver)),

   Method(static=False, Type(Name(List), Type(Name(String))), Name(resolve),
    Param(Type(Name(String)), Name(serviceName), $type=1.quark.String),
    Block(
     Return(List(Var(Name(serviceName), $type=1.quark.String),
      $type=1.quark.List<1.quark.String>)))),

   Method(static=False, Type(Name(String)), Name(_getClass), Block(
     Return(String("quark.DegenerateResolver", $type=1.quark.String)))),

   Method(static=False, Type(Name(Object)), Name(_getField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Block(
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(void)), Name(_setField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
    Block()),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_DegenerateResolver_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_DegenerateResolver_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Class(Name(Client),
   Field(static=True, Type(Name(Logger)), Name(logger),
    Call(Type(Name(Logger)), String("quark.client", $type=1.quark.String),
    $type=2.quark.Logger), $type=2.quark.Logger),
   Field(static=False, Type(Name(Resolver)), Name(resolver),
   $type=5.quark.Resolver),
   Field(static=False, Type(Name(String)), Name(serviceName),
   $type=1.quark.String),
   Field(static=False, Type(Name(float)), Name(_timeout), $type=1.quark.float),
   Field(static=False, Type(Name(int)), Name(_failureLimit), Number(3,
    $type=1.quark.int), $type=1.quark.int),
   Field(static=False, Type(Name(float)), Name(_retestDelay), Number(30.0,
    $type=1.quark.float), $type=1.quark.float),
   Field(static=False, Type(Name(concurrent), Name(Lock)), Name(mutex),
   $type=6.quark.concurrent.Lock),
   Field(static=False, Type(Name(Map), Type(Name(String)),
     Type(Name(ServiceInstance))), Name(instanceMap),
   $type=1.quark.Map<1.quark.String,5.quark.ServiceInstance>),
   Field(static=False, Type(Name(int)), Name(counter), $type=1.quark.int),

   Constructor(Name(Client),
    Param(Type(Name(String)), Name(serviceName), $type=1.quark.String),
    Block(
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(serviceName),
      $type=1.quark.String), Var(Name(serviceName), $type=1.quark.String)),
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(resolver),
      $type=5.quark.Resolver), Call(Type(Name(DegenerateResolver)),
      $type=5.quark.DegenerateResolver)),
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(_timeout),
      $type=1.quark.float), Number(0.0, $type=1.quark.float)),
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(mutex),
      $type=6.quark.concurrent.Lock), Call(Type(Name(concurrent), Name(Lock)),
      $type=6.quark.concurrent.Lock)),
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(instanceMap),
      $type=1.quark.Map<1.quark.String,5.quark.ServiceInstance>), Map(,
      $type=1.quark.Map<1.quark.String,5.quark.ServiceInstance>)),
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(counter),
      $type=1.quark.int), Number(0, $type=1.quark.int)),
     Local(
      Declaration(Type(Name(int)), Name(failureLimit),
       Cast(Call(Attr(Var(Name(self), $type=5.quark.Client), Name(getField),
         $type=1.quark.Object.getField), String("failureLimit",
         $type=1.quark.String), $type=1.quark.Object), $type=1.quark.int),
      $type=1.quark.int)),
     If(Call(Attr(Var(Name(failureLimit), $type=1.quark.int), Name(__ne__),
       $type=1.quark.Object.__ne__), Null(null, $type=1.quark.Object),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(_failureLimit),
        $type=1.quark.int), Var(Name(failureLimit), $type=1.quark.int)))),
     ExprStmt(Call(Attr(Var(Name(logger), $type=2.quark.Logger), Name(info),
       $type=2.quark.Logger.info),
       Call(Attr(Call(Attr(Call(Attr(Var(Name(self), $type=5.quark.Client),
             Name(toString), $type=1.quark.Object.toString),
           $type=1.quark.String), Name(__add__), $type=1.quark.String.__add__),
          String(" failureLimit ", $type=1.quark.String),
         $type=1.quark.String), Name(__add__), $type=1.quark.String.__add__),
        Call(Attr(Attr(Var(Name(self), $type=5.quark.Client),
           Name(_failureLimit), $type=1.quark.int), Name(toString),
         $type=1.quark.int.toString), $type=1.quark.String),
       $type=1.quark.String), $type=1.quark.void)),
     Local(
      Declaration(Type(Name(float)), Name(retestDelay),
       Cast(Call(Attr(Var(Name(self), $type=5.quark.Client), Name(getField),
         $type=1.quark.Object.getField), String("retestDelay",
         $type=1.quark.String), $type=1.quark.Object), $type=1.quark.float),
      $type=1.quark.float)),
     If(Call(Attr(Var(Name(retestDelay), $type=1.quark.float), Name(__ne__),
       $type=1.quark.Object.__ne__), Null(null, $type=1.quark.Object),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(_retestDelay),
        $type=1.quark.float), Var(Name(retestDelay), $type=1.quark.float)))),
     ExprStmt(Call(Attr(Var(Name(logger), $type=2.quark.Logger), Name(info),
       $type=2.quark.Logger.info),
       Call(Attr(Call(Attr(Call(Attr(Var(Name(self), $type=5.quark.Client),
             Name(toString), $type=1.quark.Object.toString),
           $type=1.quark.String), Name(__add__), $type=1.quark.String.__add__),
          String(" retestDelay ", $type=1.quark.String), $type=1.quark.String),
         Name(__add__), $type=1.quark.String.__add__),
        Call(Attr(Attr(Var(Name(self), $type=5.quark.Client),
           Name(_retestDelay), $type=1.quark.float), Name(toString),
         $type=1.quark.float.toString), $type=1.quark.String),
       $type=1.quark.String), $type=1.quark.void)))),

   Method(static=False, Type(Name(void)), Name(setResolver),
    Param(Type(Name(Resolver)), Name(resolver), $type=5.quark.Resolver),
    Block(
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(resolver),
      $type=5.quark.Resolver), Var(Name(resolver), $type=5.quark.Resolver)))),

   Method(static=False, Type(Name(ServiceInstance)), Name(getInstance), Block(
     Local(
      Declaration(Type(Name(List), Type(Name(String))), Name(urls),
       Call(Attr(Attr(Var(Name(self), $type=5.quark.Client), Name(resolver),
         $type=5.quark.Resolver), Name(resolve),
        $type=5.quark.Resolver.resolve), Attr(Var(Name(self),
         $type=5.quark.Client), Name(serviceName), $type=1.quark.String),
       $type=1.quark.List<1.quark.String>),
      $type=1.quark.List<1.quark.String>)),
     If(Call(Attr(Call(Attr(Var(Name(urls),
          $type=1.quark.List<1.quark.String>), Name(size),
         $type=1.quark.List.size), $type=1.quark.int), Name(__le__),
       $type=1.quark.numeric.__le__), Number(0, $type=1.quark.int),
      $type=1.quark.bool), Block(
       Return(Null(null, $type=1.quark.Object)))),
     ExprStmt(Call(Attr(Var(Name(urls), $type=1.quark.List<1.quark.String>),
        Name(sort), $type=1.quark.List.sort), $type=1.quark.void)),
     ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.Client),
         Name(mutex), $type=6.quark.concurrent.Lock), Name(acquire),
       $type=6.quark.concurrent.Mutex.acquire), $type=1.quark.void)),
     Local(
      Declaration(Type(Name(ServiceInstance)), Name(result), Null(null,
       $type=1.quark.Object), $type=5.quark.ServiceInstance)),
     Local(
      Declaration(Type(Name(int)), Name(next), Call(Attr(Attr(Var(Name(self),
          $type=5.quark.Client), Name(counter), $type=1.quark.int),
         Name(__mod__), $type=1.quark.integral.__mod__),
        Call(Attr(Var(Name(urls), $type=1.quark.List<1.quark.String>),
          Name(size), $type=1.quark.List.size), $type=1.quark.int),
       $type=1.quark.int), $type=1.quark.int)),
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(counter),
      $type=1.quark.int), Call(Attr(Attr(Var(Name(self), $type=5.quark.Client),
         Name(counter), $type=1.quark.int), Name(__add__),
       $type=1.quark.numeric.__add__), Number(1, $type=1.quark.int),
      $type=1.quark.int)),
     Local(
      Declaration(Type(Name(int)), Name(idx), Var(Name(next),
       $type=1.quark.int), $type=1.quark.int)),
     While(Bool(true, $type=1.quark.bool), Block(
       Local(
        Declaration(Type(Name(String)), Name(url), Call(Attr(Var(Name(urls),
           $type=1.quark.List<1.quark.String>), Name(__get__),
          $type=1.quark.List.__get__), Var(Name(idx), $type=1.quark.int),
         $type=1.quark.String), $type=1.quark.String)),
       Local(
        Declaration(Type(Name(ServiceInstance)), Name(instance),
         Call(Attr(Attr(Var(Name(self), $type=5.quark.Client),
            Name(instanceMap),
           $type=1.quark.Map<1.quark.String,5.quark.ServiceInstance>),
           Name(__get__), $type=1.quark.Map.__get__), Var(Name(url),
          $type=1.quark.String), $type=5.quark.ServiceInstance),
        $type=5.quark.ServiceInstance)),
       If(Call(Attr(Var(Name(instance), $type=5.quark.ServiceInstance),
          Name(__eq__), $type=1.quark.Object.__eq__), Null(null,
         $type=1.quark.Object), $type=1.quark.bool), Block(
         Assign(Var(Name(instance), $type=5.quark.ServiceInstance),
          Call(Type(Name(ServiceInstance)), Attr(Var(Name(self),
            $type=5.quark.Client), Name(serviceName), $type=1.quark.String),
           Var(Name(url), $type=1.quark.String), Var(Name(_failureLimit),
           $type=1.quark.int), Var(Name(_retestDelay), $type=1.quark.float),
          $type=5.quark.ServiceInstance)),
         ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.Client),
             Name(instanceMap),
            $type=1.quark.Map<1.quark.String,5.quark.ServiceInstance>),
            Name(__set__), $type=1.quark.Map.__set__), Var(Name(url),
           $type=1.quark.String), Var(Name(instance),
           $type=5.quark.ServiceInstance), $type=1.quark.void)))),
       If(Call(Attr(Var(Name(instance), $type=5.quark.ServiceInstance),
          Name(isActive), $type=5.quark.ServiceInstance.isActive),
        $type=1.quark.bool), Block(
         ExprStmt(Call(Attr(Attr(Var(Name(Client), $type=5.quark.Client),
             Name(logger), $type=2.quark.Logger), Name(info),
           $type=2.quark.Logger.info),
           Call(Attr(Call(Attr(Call(Attr(Call(Attr(Call(Attr(String("- ",
                     $type=1.quark.String), Name(__add__),
                    $type=1.quark.String.__add__), Attr(Var(Name(self),
                     $type=5.quark.Client), Name(serviceName),
                    $type=1.quark.String), $type=1.quark.String),
                   Name(__add__), $type=1.quark.String.__add__),
                  String(" using instance ", $type=1.quark.String),
                 $type=1.quark.String), Name(__add__),
                $type=1.quark.String.__add__),
                Call(Attr(Call(Attr(Var(Name(idx), $type=1.quark.int),
                    Name(__add__), $type=1.quark.numeric.__add__), Number(1,
                   $type=1.quark.int), $type=1.quark.int), Name(toString),
                 $type=1.quark.int.toString), $type=1.quark.String),
               $type=1.quark.String), Name(__add__),
              $type=1.quark.String.__add__), String(": ",
              $type=1.quark.String), $type=1.quark.String), Name(__add__),
            $type=1.quark.String.__add__), Var(Name(url),
            $type=1.quark.String), $type=1.quark.String), $type=1.quark.void)),
         Assign(Var(Name(result), $type=5.quark.ServiceInstance),
          Var(Name(instance), $type=5.quark.ServiceInstance)),
         Break())),
       Assign(Var(Name(idx), $type=1.quark.int),
        Call(Attr(Call(Attr(Var(Name(idx), $type=1.quark.int), Name(__add__),
           $type=1.quark.numeric.__add__), Number(1, $type=1.quark.int),
          $type=1.quark.int), Name(__mod__), $type=1.quark.integral.__mod__),
         Call(Attr(Var(Name(urls), $type=1.quark.List<1.quark.String>),
           Name(size), $type=1.quark.List.size), $type=1.quark.int),
        $type=1.quark.int)),
       If(Call(Attr(Var(Name(idx), $type=1.quark.int), Name(__eq__),
         $type=1.quark.Object.__eq__), Var(Name(next), $type=1.quark.int),
        $type=1.quark.bool), Block(
         ExprStmt(Call(Attr(Attr(Var(Name(Client), $type=5.quark.Client),
             Name(logger), $type=2.quark.Logger), Name(info),
           $type=2.quark.Logger.info), Call(Attr(Call(Attr(String("- ",
               $type=1.quark.String), Name(__add__),
              $type=1.quark.String.__add__), Attr(Var(Name(self),
               $type=5.quark.Client), Name(serviceName), $type=1.quark.String),
             $type=1.quark.String), Name(__add__),
            $type=1.quark.String.__add__),
            String(": no live instances! giving up.", $type=1.quark.String),
           $type=1.quark.String), $type=1.quark.void)),
         Break())))),
     ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.Client),
         Name(mutex), $type=6.quark.concurrent.Lock), Name(release),
       $type=6.quark.concurrent.Mutex.release), $type=1.quark.void)),
     Return(Var(Name(result), $type=5.quark.ServiceInstance)))),

   Method(static=False, Type(Name(String)), Name(getName), Block(
     Return(Attr(Var(Name(self), $type=5.quark.Client), Name(serviceName),
      $type=1.quark.String)))),

   Method(static=False, Type(Name(float)), Name(getTimeout), Block(
     Return(Attr(Var(Name(self), $type=5.quark.Client), Name(_timeout),
      $type=1.quark.float)))),

   Method(static=False, Type(Name(void)), Name(setTimeout),
    Param(Type(Name(float)), Name(timeout), $type=1.quark.float),
    Block(
     Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(_timeout),
      $type=1.quark.float), Var(Name(timeout), $type=1.quark.float)))),

   Method(static=False, Type(Name(String)), Name(_getClass), Block(
     Return(String("quark.Client", $type=1.quark.String)))),

   Method(static=False, Type(Name(Object)), Name(_getField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("logger", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(logger),
        $type=2.quark.Logger)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("resolver", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(resolver),
        $type=5.quark.Resolver)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("serviceName",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(serviceName),
        $type=1.quark.String)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("_timeout", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(_timeout),
        $type=1.quark.float)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("_failureLimit",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(_failureLimit),
        $type=1.quark.int)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("_retestDelay",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(_retestDelay),
        $type=1.quark.float)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("mutex", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(mutex),
        $type=6.quark.concurrent.Lock)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("instanceMap",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(instanceMap),
        $type=1.quark.Map<1.quark.String,5.quark.ServiceInstance>)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("counter", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Client), Name(counter),
        $type=1.quark.int)))),
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(void)), Name(_setField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("logger", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(logger),
        $type=2.quark.Logger), Cast(Var(Name(value), $type=1.quark.Object),
        $type=2.quark.Logger)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("resolver", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(resolver),
        $type=5.quark.Resolver), Cast(Var(Name(value), $type=1.quark.Object),
        $type=5.quark.Resolver)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("serviceName",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(serviceName),
        $type=1.quark.String), Cast(Var(Name(value), $type=1.quark.Object),
        $type=1.quark.String)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("_timeout", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(_timeout),
        $type=1.quark.float), Cast(Var(Name(value), $type=1.quark.Object),
        $type=1.quark.float)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("_failureLimit",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(_failureLimit),
        $type=1.quark.int), Cast(Var(Name(value), $type=1.quark.Object),
        $type=1.quark.int)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("_retestDelay",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(_retestDelay),
        $type=1.quark.float), Cast(Var(Name(value), $type=1.quark.Object),
        $type=1.quark.float)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("mutex", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(mutex),
        $type=6.quark.concurrent.Lock), Cast(Var(Name(value),
         $type=1.quark.Object), $type=6.quark.concurrent.Lock)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("instanceMap",
       $type=1.quark.String), $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(instanceMap),
        $type=1.quark.Map<1.quark.String,5.quark.ServiceInstance>),
        Cast(Var(Name(value), $type=1.quark.Object),
        $type=1.quark.Map<1.quark.String,5.quark.ServiceInstance>)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("counter", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Client), Name(counter),
        $type=1.quark.int), Cast(Var(Name(value), $type=1.quark.Object),
        $type=1.quark.int)))))),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_Map_quark_String_quark_ServiceInstance__ref),
    Call(Attr(Var(Name(reflect), $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_Map_quark_String_quark_ServiceInstance__md),
     $type=3.quark.reflect.Class), $type=3.quark.reflect.Class),
   $type=3.quark.reflect.Class),
   Field(static=True, Type(Name(reflect), Name(Class)), Name(quark_Client_ref),
    Call(Attr(Var(Name(reflect), $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_Client_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Class(Name(ServerResponder), Type(Name(concurrent), Name(FutureListener)),
   Field(static=False, Type(Name(bool)), Name(sendCORS), $type=1.quark.bool),
   Field(static=False, Type(Name(HTTPRequest)), Name(request),
   $type=7.quark.HTTPRequest),
   Field(static=False, Type(Name(HTTPResponse)), Name(response),
   $type=7.quark.HTTPResponse),

   Constructor(Name(ServerResponder),
    Param(Type(Name(bool)), Name(sendCORS), $type=1.quark.bool),
    Param(Type(Name(HTTPRequest)), Name(request), $type=7.quark.HTTPRequest),
    Param(Type(Name(HTTPResponse)), Name(response),
    $type=7.quark.HTTPResponse),
    Block(
     Assign(Attr(Var(Name(self), $type=5.quark.ServerResponder),
       Name(sendCORS), $type=1.quark.bool), Var(Name(sendCORS),
      $type=1.quark.bool)),
     Assign(Attr(Var(Name(self), $type=5.quark.ServerResponder), Name(request),
      $type=7.quark.HTTPRequest), Var(Name(request),
      $type=7.quark.HTTPRequest)),
     Assign(Attr(Var(Name(self), $type=5.quark.ServerResponder),
       Name(response), $type=7.quark.HTTPResponse), Var(Name(response),
      $type=7.quark.HTTPResponse)))),

   Method(static=False, Type(Name(void)), Name(onFuture),
    Param(Type(Name(concurrent), Name(Future)), Name(result),
    $type=6.quark.concurrent.Future),
    Block(
     Local(
      Declaration(Type(Name(Error)), Name(error), Call(Attr(Var(Name(result),
         $type=6.quark.concurrent.Future), Name(getError),
        $type=6.quark.concurrent.Future.getError), $type=1.quark.error.Error),
      $type=1.quark.error.Error)),
     If(Call(Attr(Var(Name(error), $type=1.quark.error.Error), Name(__ne__),
       $type=1.quark.Object.__ne__), Null(null, $type=1.quark.Object),
      $type=1.quark.bool), Block(
       ExprStmt(Call(Attr(Var(Name(response), $type=7.quark.HTTPResponse),
          Name(setCode), $type=7.quark.HTTPResponse.setCode), Number(404,
         $type=1.quark.int), $type=1.quark.void))), Block(
       If(Attr(Var(Name(self), $type=5.quark.ServerResponder), Name(sendCORS),
        $type=1.quark.bool), Block(
         ExprStmt(Call(Attr(Attr(Var(Name(self),
             $type=5.quark.ServerResponder), Name(response),
            $type=7.quark.HTTPResponse), Name(setHeader),
           $type=7.quark.HTTPResponse.setHeader),
           String("Access-Control-Allow-Origin", $type=1.quark.String),
           String("*", $type=1.quark.String), $type=1.quark.void)))),
       ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.ServerResponder),
           Name(response), $type=7.quark.HTTPResponse), Name(setBody),
         $type=7.quark.HTTPResponse.setBody), Call(Attr(Call(Var(Name(toJSON),
            $type=4.quark.toJSON), Var(Name(result),
            $type=6.quark.concurrent.Future), Null(null, $type=1.quark.Object),
           $type=4.quark.JSONObject), Name(toString),
          $type=4.quark.JSONObject.toString), $type=1.quark.String),
        $type=1.quark.void)),
       ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.ServerResponder),
           Name(response), $type=7.quark.HTTPResponse), Name(setCode),
         $type=7.quark.HTTPResponse.setCode), Number(200, $type=1.quark.int),
        $type=1.quark.void)))),
     ExprStmt(Call(Attr(Call(Attr(Attr(Var(Name(concurrent),
           $type=6.quark.concurrent), Name(Context),
          $type=6.quark.concurrent.Context), Name(runtime),
         $type=6.quark.concurrent.Context.runtime), $type=0.quark.Runtime),
        Name(respond), $type=0.quark.Runtime.respond), Var(Name(request),
       $type=7.quark.HTTPRequest), Var(Name(response),
       $type=7.quark.HTTPResponse), $type=1.quark.void)))),

   Method(static=False, Type(Name(String)), Name(_getClass), Block(
     Return(String("quark.ServerResponder", $type=1.quark.String)))),

   Method(static=False, Type(Name(Object)), Name(_getField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("sendCORS", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ServerResponder),
         Name(sendCORS), $type=1.quark.bool)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("request", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ServerResponder),
         Name(request), $type=7.quark.HTTPRequest)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("response", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.ServerResponder),
         Name(response), $type=7.quark.HTTPResponse)))),
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(void)), Name(_setField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("sendCORS", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ServerResponder),
         Name(sendCORS), $type=1.quark.bool), Cast(Var(Name(value),
         $type=1.quark.Object), $type=1.quark.bool)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("request", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ServerResponder),
         Name(request), $type=7.quark.HTTPRequest), Cast(Var(Name(value),
         $type=1.quark.Object), $type=7.quark.HTTPRequest)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("response", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.ServerResponder),
         Name(response), $type=7.quark.HTTPResponse), Cast(Var(Name(value),
         $type=1.quark.Object), $type=7.quark.HTTPResponse)))))),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_ServerResponder_ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_ServerResponder_md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Class(Name(Server), TypeParam(Name(T)), Type(Name(HTTPServlet)),
   Field(static=False, Type(Name(T)), Name(impl), $type=5.quark.Server.T),
   Field(static=False, Type(Name(bool)), Name(_sendCORS), $type=1.quark.bool),

   Constructor(Name(Server),
    Param(Type(Name(T)), Name(impl), $type=5.quark.Server.T),
    Block(
     Assign(Attr(Var(Name(self), $type=5.quark.Server<5.quark.Server.T>),
       Name(impl), $type=5.quark.Server.T), Var(Name(impl),
      $type=5.quark.Server.T)),
     Assign(Attr(Var(Name(self), $type=5.quark.Server<5.quark.Server.T>),
       Name(_sendCORS), $type=1.quark.bool), Bool(false,
      $type=1.quark.bool)))),

   Method(static=False, Type(Name(void)), Name(sendCORS),
    Param(Type(Name(bool)), Name(send), $type=1.quark.bool),
    Block(
     Assign(Attr(Var(Name(self), $type=5.quark.Server<5.quark.Server.T>),
       Name(_sendCORS), $type=1.quark.bool), Var(Name(send),
      $type=1.quark.bool)))),

   Method(static=False, Type(Name(void)), Name(onHTTPRequest),
    Param(Type(Name(HTTPRequest)), Name(request), $type=7.quark.HTTPRequest),
    Param(Type(Name(HTTPResponse)), Name(response),
    $type=7.quark.HTTPResponse),
    Block(
     Local(
      Declaration(Type(Name(String)), Name(body), Call(Attr(Var(Name(request),
         $type=7.quark.HTTPRequest), Name(getBody),
        $type=7.quark.HTTPRequest.getBody), $type=1.quark.String),
      $type=1.quark.String)),
     Local(
      Declaration(Type(Name(JSONObject)), Name(envelope),
       Call(Attr(Var(Name(body), $type=1.quark.String), Name(parseJSON),
        $type=1.quark.String.parseJSON), $type=4.quark.JSONObject),
      $type=4.quark.JSONObject)),
     If(Call(Attr(Call(Attr(Call(Attr(Var(Name(envelope),
            $type=4.quark.JSONObject), Name(__get__),
           $type=4.quark.JSONObject.__get__), String("$method",
           $type=1.quark.String), $type=4.quark.JSONObject), Name(__eq__),
         $type=1.quark.Object.__eq__), Call(Attr(Var(Name(envelope),
           $type=4.quark.JSONObject), Name(undefined),
          $type=4.quark.JSONObject.undefined), $type=4.quark.JSONObject),
        $type=1.quark.bool), Name(__or__), $type=1.quark.bool.__or__),
       Call(Attr(Call(Attr(Var(Name(envelope), $type=4.quark.JSONObject),
           Name(__get__), $type=4.quark.JSONObject.__get__), String("rpc",
          $type=1.quark.String), $type=4.quark.JSONObject), Name(__eq__),
        $type=1.quark.Object.__eq__), Call(Attr(Var(Name(envelope),
          $type=4.quark.JSONObject), Name(undefined),
         $type=4.quark.JSONObject.undefined), $type=4.quark.JSONObject),
       $type=1.quark.bool), $type=1.quark.bool), Block(
       ExprStmt(Call(Attr(Var(Name(response), $type=7.quark.HTTPResponse),
          Name(setBody), $type=7.quark.HTTPResponse.setBody),
         Call(Attr(Call(Attr(String("Failed to understand request.\n\n",
             $type=1.quark.String), Name(__add__),
            $type=1.quark.String.__add__), Var(Name(body),
            $type=1.quark.String), $type=1.quark.String), Name(__add__),
          $type=1.quark.String.__add__), String("\n", $type=1.quark.String),
         $type=1.quark.String), $type=1.quark.void)),
       ExprStmt(Call(Attr(Var(Name(response), $type=7.quark.HTTPResponse),
          Name(setCode), $type=7.quark.HTTPResponse.setCode), Number(400,
         $type=1.quark.int), $type=1.quark.void)),
       ExprStmt(Call(Attr(Call(Attr(Attr(Var(Name(concurrent),
             $type=6.quark.concurrent), Name(Context),
            $type=6.quark.concurrent.Context), Name(runtime),
           $type=6.quark.concurrent.Context.runtime), $type=0.quark.Runtime),
          Name(respond), $type=0.quark.Runtime.respond), Var(Name(request),
         $type=7.quark.HTTPRequest), Var(Name(response),
         $type=7.quark.HTTPResponse), $type=1.quark.void))), Block(
       Local(
        Declaration(Type(Name(String)), Name(methodName),
         Call(Attr(Var(Name(envelope), $type=4.quark.JSONObject),
           Name(__get__), $type=4.quark.JSONObject.__get__), String("$method",
          $type=1.quark.String), $type=4.quark.JSONObject),
        $type=1.quark.String)),
       Local(
        Declaration(Type(Name(JSONObject)), Name(json),
         Call(Attr(Var(Name(envelope), $type=4.quark.JSONObject),
           Name(__get__), $type=4.quark.JSONObject.__get__), String("rpc",
          $type=1.quark.String), $type=4.quark.JSONObject),
        $type=4.quark.JSONObject)),
       Local(
        Declaration(Type(Name(reflect), Name(Method)), Name(method),
         Call(Attr(Call(Attr(Call(Attr(Call(Attr(Var(Name(self),
                 $type=5.quark.Server<5.quark.Server.T>), Name(getClass),
                $type=1.quark.Object.getClass), $type=3.quark.reflect.Class),
               Name(getField), $type=3.quark.reflect.Class.getField),
              String("impl", $type=1.quark.String),
             $type=3.quark.reflect.Field), Name(getType),
            $type=3.quark.reflect.Field.getType), $type=3.quark.reflect.Class),
           Name(getMethod), $type=3.quark.reflect.Class.getMethod),
          Var(Name(methodName), $type=1.quark.String),
         $type=3.quark.reflect.Method), $type=3.quark.reflect.Method)),
       Local(
        Declaration(Type(Name(List), Type(Name(reflect), Name(Class))),
         Name(params), Call(Attr(Var(Name(method),
           $type=3.quark.reflect.Method), Name(getParameters),
          $type=3.quark.reflect.Method.getParameters),
         $type=1.quark.List<3.quark.reflect.Class>),
        $type=1.quark.List<3.quark.reflect.Class>)),
       Local(
        Declaration(Type(Name(List), Type(Name(Object))), Name(args), List(,
         $type=1.quark.List<1.quark.Object>),
        $type=1.quark.List<1.quark.Object>)),
       Local(
        Declaration(Type(Name(int)), Name(idx), Number(0, $type=1.quark.int),
        $type=1.quark.int)),
       While(Call(Attr(Var(Name(idx), $type=1.quark.int), Name(__lt__),
         $type=1.quark.numeric.__lt__), Call(Attr(Var(Name(params),
           $type=1.quark.List<3.quark.reflect.Class>), Name(size),
          $type=1.quark.List.size), $type=1.quark.int), $type=1.quark.bool),
        Block(
         ExprStmt(Call(Attr(Var(Name(args),
            $type=1.quark.List<1.quark.Object>), Name(add),
           $type=1.quark.List.add), Call(Var(Name(fromJSON),
            $type=4.quark.fromJSON), Call(Attr(Var(Name(params),
              $type=1.quark.List<3.quark.reflect.Class>), Name(__get__),
             $type=1.quark.List.__get__), Var(Name(idx), $type=1.quark.int),
            $type=3.quark.reflect.Class), Null(null, $type=1.quark.Object),
            Call(Attr(Var(Name(json), $type=4.quark.JSONObject),
              Name(getListItem), $type=4.quark.JSONObject.getListItem),
             Var(Name(idx), $type=1.quark.int), $type=4.quark.JSONObject),
           $type=1.quark.Object), $type=1.quark.void)),
         Assign(Var(Name(idx), $type=1.quark.int), Call(Attr(Var(Name(idx),
            $type=1.quark.int), Name(__add__), $type=1.quark.numeric.__add__),
           Number(1, $type=1.quark.int), $type=1.quark.int)))),
       Local(
        Declaration(Type(Name(concurrent), Name(Future)), Name(result),
         Cast(Call(Attr(Var(Name(method), $type=3.quark.reflect.Method),
            Name(invoke), $type=3.quark.reflect.Method.invoke), Var(Name(impl),
           $type=5.quark.Server.T), Var(Name(args),
           $type=1.quark.List<1.quark.Object>), $type=1.quark.Object),
         $type=6.quark.concurrent.Future), $type=6.quark.concurrent.Future)),
       ExprStmt(Call(Attr(Var(Name(result), $type=6.quark.concurrent.Future),
          Name(onFinished), $type=6.quark.concurrent.Future.onFinished),
         Call(Type(Name(ServerResponder)), Attr(Var(Name(self),
           $type=5.quark.Server<5.quark.Server.T>), Name(_sendCORS),
          $type=1.quark.bool), Var(Name(request), $type=7.quark.HTTPRequest),
          Var(Name(response), $type=7.quark.HTTPResponse),
         $type=5.quark.ServerResponder), $type=1.quark.void)))))),

   Method(static=False, Type(Name(void)), Name(onServletError),
    Param(Type(Name(String)), Name(url), $type=1.quark.String),
    Param(Type(Name(ServletError)), Name(error), $type=5.quark.ServletError),
    Block(
     ExprStmt(Call(Attr(Call(Attr(Attr(Var(Name(concurrent),
           $type=6.quark.concurrent), Name(Context),
          $type=6.quark.concurrent.Context), Name(runtime),
         $type=6.quark.concurrent.Context.runtime), $type=0.quark.Runtime),
        Name(fail), $type=0.quark.Runtime.fail),
       Call(Attr(Call(Attr(Call(Attr(String("RPC Server failed to register ",
             $type=1.quark.String), Name(__add__),
            $type=1.quark.String.__add__), Var(Name(url),
            $type=1.quark.String), $type=1.quark.String), Name(__add__),
          $type=1.quark.String.__add__), String(" due to: ",
          $type=1.quark.String), $type=1.quark.String), Name(__add__),
        $type=1.quark.String.__add__), Call(Attr(Var(Name(error),
          $type=5.quark.ServletError), Name(getMessage),
         $type=1.quark.error.Error.getMessage), $type=1.quark.String),
       $type=1.quark.String), $type=1.quark.void)))),

   Method(static=False, Type(Name(String)), Name(_getClass), Block(
     Return(String("quark.Server<quark.Object>", $type=1.quark.String)))),

   Method(static=False, Type(Name(Object)), Name(_getField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("impl", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Server<5.quark.Server.T>),
         Name(impl), $type=5.quark.Server.T)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("_sendCORS", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Return(Attr(Var(Name(self), $type=5.quark.Server<5.quark.Server.T>),
         Name(_sendCORS), $type=1.quark.bool)))),
     Return(Null(null, $type=1.quark.Object)))),

   Method(static=False, Type(Name(void)), Name(_setField),
    Param(Type(Name(String)), Name(name), $type=1.quark.String),
    Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
    Block(
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("impl", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Server<5.quark.Server.T>),
         Name(impl), $type=5.quark.Server.T), Cast(Var(Name(value),
         $type=1.quark.Object), $type=5.quark.Server.T)))),
     If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
       $type=1.quark.Object.__eq__), String("_sendCORS", $type=1.quark.String),
      $type=1.quark.bool), Block(
       Assign(Attr(Var(Name(self), $type=5.quark.Server<5.quark.Server.T>),
         Name(_sendCORS), $type=1.quark.bool), Cast(Var(Name(value),
         $type=1.quark.Object), $type=1.quark.bool)))))),
   Field(static=True, Type(Name(reflect), Name(Class)),
    Name(quark_Server_quark_Object__ref), Call(Attr(Var(Name(reflect),
      $type=3.quark.reflect), Name(__register__),
     $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
       $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
      Name(quark_Server_quark_Object__md), $type=3.quark.reflect.Class),
    $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

  Package(Name(behaviors),

   Class(Name(RPCError), Type(Name(Error)),

    Method(static=False, Type(Name(String)), Name(_getClass), Block(
      Return(String("quark.behaviors.RPCError", $type=1.quark.String)))),

    Method(static=False, Type(Name(Object)), Name(_getField),
     Param(Type(Name(String)), Name(name), $type=1.quark.String),
     Block(
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("message", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPCError),
          Name(message), $type=1.quark.String)))),
      Return(Null(null, $type=1.quark.Object)))),

    Method(static=False, Type(Name(void)), Name(_setField),
     Param(Type(Name(String)), Name(name), $type=1.quark.String),
     Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
     Block(
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("message", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCError),
          Name(message), $type=1.quark.String), Cast(Var(Name(value),
          $type=1.quark.Object), $type=1.quark.String)))))),
    Field(static=True, Type(Name(reflect), Name(Class)),
     Name(quark_behaviors_RPCError_ref), Call(Attr(Var(Name(reflect),
       $type=3.quark.reflect), Name(__register__),
      $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
        $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
       Name(quark_behaviors_RPCError_md), $type=3.quark.reflect.Class),
     $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

   Class(Name(RPC),
    Field(static=False, Type(Name(Service)), Name(service),
    $type=5.quark.Service),
    Field(static=False, Type(Name(reflect), Name(Class)), Name(returned),
    $type=3.quark.reflect.Class),
    Field(static=False, Type(Name(float)), Name(timeout), $type=1.quark.float),
    Field(static=False, Type(Name(String)), Name(methodName),
    $type=1.quark.String),
    Field(static=False, Type(Name(ServiceInstance)), Name(instance),
    $type=5.quark.ServiceInstance),

    Constructor(Name(RPC),
     Param(Type(Name(Service)), Name(service), $type=5.quark.Service),
     Param(Type(Name(String)), Name(methodName), $type=1.quark.String),
     Block(
      Local(
       Declaration(Type(Name(float)), Name(timeout),
        Cast(Call(Attr(Var(Name(service), $type=5.quark.Service),
           Name(getField), $type=1.quark.Object.getField), String("timeout",
          $type=1.quark.String), $type=1.quark.Object), $type=1.quark.float),
       $type=1.quark.float)),
      If(Call(Attr(Call(Attr(Var(Name(timeout), $type=1.quark.float),
           Name(__eq__), $type=1.quark.Object.__eq__), Null(null,
          $type=1.quark.Object), $type=1.quark.bool), Name(__or__),
        $type=1.quark.bool.__or__), Call(Attr(Var(Name(timeout),
          $type=1.quark.float), Name(__le__), $type=1.quark.numeric.__le__),
         Number(0.0, $type=1.quark.float), $type=1.quark.bool),
       $type=1.quark.bool), Block(
        Assign(Var(Name(timeout), $type=1.quark.float), Number(10.0,
         $type=1.quark.float)))),
      Local(
       Declaration(Type(Name(float)), Name(override),
        Call(Attr(Var(Name(service), $type=5.quark.Service), Name(getTimeout),
         $type=5.quark.Service.getTimeout), $type=1.quark.float),
       $type=1.quark.float)),
      If(Call(Attr(Call(Attr(Var(Name(override), $type=1.quark.float),
           Name(__ne__), $type=1.quark.Object.__ne__), Null(null,
          $type=1.quark.Object), $type=1.quark.bool), Name(__and__),
        $type=1.quark.bool.__and__), Call(Attr(Var(Name(override),
          $type=1.quark.float), Name(__gt__), $type=1.quark.numeric.__gt__),
         Number(0.0, $type=1.quark.float), $type=1.quark.bool),
       $type=1.quark.bool), Block(
        Assign(Var(Name(timeout), $type=1.quark.float), Var(Name(override),
         $type=1.quark.float)))),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC), Name(returned),
       $type=3.quark.reflect.Class),
       Call(Attr(Call(Attr(Call(Attr(Var(Name(service), $type=5.quark.Service),
             Name(getClass), $type=1.quark.Object.getClass),
           $type=3.quark.reflect.Class), Name(getMethod),
          $type=3.quark.reflect.Class.getMethod), Var(Name(methodName),
          $type=1.quark.String), $type=3.quark.reflect.Method), Name(getType),
        $type=3.quark.reflect.Method.getType), $type=3.quark.reflect.Class)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC), Name(timeout),
       $type=1.quark.float), Var(Name(timeout), $type=1.quark.float)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
        Name(methodName), $type=1.quark.String), Var(Name(methodName),
       $type=1.quark.String)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC), Name(service),
       $type=5.quark.Service), Var(Name(service), $type=5.quark.Service)))),

    Method(static=False, Type(Name(concurrent), Name(Future)), Name(call),
     Param(Type(Name(List), Type(Name(Object))), Name(args),
     $type=1.quark.List<1.quark.Object>),
     Block(
      Local(
       Declaration(Type(Name(concurrent), Name(Future)), Name(result),
        Null(null, $type=1.quark.Object), $type=6.quark.concurrent.Future)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC), Name(instance),
       $type=5.quark.ServiceInstance), Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.RPC), Name(service), $type=5.quark.Service),
         Name(getInstance), $type=5.quark.Service.getInstance),
       $type=5.quark.ServiceInstance)),
      If(Call(Attr(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(instance), $type=5.quark.ServiceInstance), Name(__ne__),
        $type=1.quark.Object.__ne__), Null(null, $type=1.quark.Object),
       $type=1.quark.bool), Block(
        Local(
         Declaration(Type(Name(HTTPRequest)), Name(request),
          Call(Type(Name(HTTPRequest)), Call(Attr(Attr(Var(Name(self),
              $type=5.quark.behaviors.RPC), Name(instance),
             $type=5.quark.ServiceInstance), Name(getURL),
            $type=5.quark.ServiceInstance.getURL), $type=1.quark.String),
          $type=7.quark.HTTPRequest), $type=7.quark.HTTPRequest)),
        Local(
         Declaration(Type(Name(JSONObject)), Name(json), Call(Var(Name(toJSON),
           $type=4.quark.toJSON), Var(Name(args),
           $type=1.quark.List<1.quark.Object>), Null(null,
           $type=1.quark.Object), $type=4.quark.JSONObject),
         $type=4.quark.JSONObject)),
        Local(
         Declaration(Type(Name(JSONObject)), Name(envelope),
          Call(Type(Name(JSONObject)), $type=4.quark.JSONObject),
         $type=4.quark.JSONObject)),
        ExprStmt(Call(Attr(Var(Name(envelope), $type=4.quark.JSONObject),
           Name(__set__), $type=4.quark.JSONObject.__set__), String("$method",
          $type=1.quark.String), Attr(Var(Name(self),
           $type=5.quark.behaviors.RPC), Name(methodName),
          $type=1.quark.String), $type=1.quark.void)),
        ExprStmt(Call(Attr(Var(Name(envelope), $type=4.quark.JSONObject),
           Name(__set__), $type=4.quark.JSONObject.__set__), String("$context",
          $type=1.quark.String), String("TBD", $type=1.quark.String),
         $type=1.quark.void)),
        ExprStmt(Call(Attr(Var(Name(envelope), $type=4.quark.JSONObject),
           Name(__set__), $type=4.quark.JSONObject.__set__), String("rpc",
          $type=1.quark.String), Var(Name(json), $type=4.quark.JSONObject),
         $type=1.quark.void)),
        Local(
         Declaration(Type(Name(String)), Name(body),
          Call(Attr(Var(Name(envelope), $type=4.quark.JSONObject),
            Name(toString), $type=4.quark.JSONObject.toString),
          $type=1.quark.String), $type=1.quark.String)),
        ExprStmt(Call(Attr(Var(Name(request), $type=7.quark.HTTPRequest),
           Name(setBody), $type=7.quark.HTTPRequest.setBody), Var(Name(body),
          $type=1.quark.String), $type=1.quark.void)),
        ExprStmt(Call(Attr(Var(Name(request), $type=7.quark.HTTPRequest),
           Name(setMethod), $type=7.quark.HTTPRequest.setMethod),
          String("POST", $type=1.quark.String), $type=1.quark.void)),
        Local(
         Declaration(Type(Name(RPCRequest)), Name(rpc),
          Call(Type(Name(RPCRequest)), Var(Name(args),
           $type=1.quark.List<1.quark.Object>), Var(Name(self),
           $type=5.quark.behaviors.RPC), $type=5.quark.behaviors.RPCRequest),
         $type=5.quark.behaviors.RPCRequest)),
        Assign(Var(Name(result), $type=6.quark.concurrent.Future),
         Call(Attr(Var(Name(rpc), $type=5.quark.behaviors.RPCRequest),
           Name(call), $type=5.quark.behaviors.RPCRequest.call),
          Var(Name(request), $type=7.quark.HTTPRequest),
         $type=6.quark.concurrent.Future))), Block(
        Assign(Var(Name(result), $type=6.quark.concurrent.Future),
         Cast(Call(Attr(Var(Name(returned), $type=3.quark.reflect.Class),
            Name(construct), $type=3.quark.reflect.Class.construct), List(,
           $type=1.quark.List<1.quark.Object>), $type=1.quark.Object),
         $type=6.quark.concurrent.Future)),
        ExprStmt(Call(Attr(Var(Name(result), $type=6.quark.concurrent.Future),
           Name(finish), $type=6.quark.concurrent.Future.finish),
          Call(Var(Name(RPCError), $type=5.quark.behaviors.RPCError),
           String("all services are down", $type=1.quark.String),
          $type=5.quark.behaviors.RPCError), $type=1.quark.void)))),
      ExprStmt(Call(Attr(Attr(Var(Name(concurrent), $type=6.quark.concurrent),
          Name(FutureWait), $type=6.quark.concurrent.FutureWait),
         Name(waitFor), $type=6.quark.concurrent.FutureWait.waitFor),
        Var(Name(result), $type=6.quark.concurrent.Future), Number(10.0,
        $type=1.quark.float), $type=6.quark.concurrent.Future)),
      Return(Var(Name(result), $type=6.quark.concurrent.Future)))),

    Method(static=False, Type(Name(void)), Name(succeed),
     Param(Type(Name(String)), Name(info), $type=1.quark.String),
     Block(
      ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(instance), $type=5.quark.ServiceInstance), Name(succeed),
        $type=5.quark.ServiceInstance.succeed), Var(Name(info),
        $type=1.quark.String), $type=1.quark.void)))),

    Method(static=False, Type(Name(void)), Name(fail),
     Param(Type(Name(String)), Name(info), $type=1.quark.String),
     Block(
      ExprStmt(Call(Attr(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(instance), $type=5.quark.ServiceInstance), Name(fail),
        $type=5.quark.ServiceInstance.fail), Var(Name(info),
        $type=1.quark.String), $type=1.quark.void)))),

    Method(static=False, Type(Name(String)), Name(toString), Block(

      Return(Call(Attr(Call(Attr(Call(Attr(Call(Attr(Call(Attr(Call(Attr(String("RPC ",
                   $type=1.quark.String), Name(__add__),
                  $type=1.quark.String.__add__), Call(Attr(Attr(Var(Name(self),
                     $type=5.quark.behaviors.RPC), Name(service),
                    $type=5.quark.Service), Name(getName),
                   $type=5.quark.Service.getName), $type=1.quark.String),
                 $type=1.quark.String), Name(__add__),
                $type=1.quark.String.__add__), String(" at ",
                $type=1.quark.String), $type=1.quark.String), Name(__add__),
              $type=1.quark.String.__add__), Call(Attr(Attr(Var(Name(self),
                 $type=5.quark.behaviors.RPC), Name(instance),
                $type=5.quark.ServiceInstance), Name(getURL),
               $type=5.quark.ServiceInstance.getURL), $type=1.quark.String),
             $type=1.quark.String), Name(__add__),
            $type=1.quark.String.__add__), String(": ", $type=1.quark.String),
           $type=1.quark.String), Name(__add__), $type=1.quark.String.__add__),
          Attr(Var(Name(self), $type=5.quark.behaviors.RPC), Name(methodName),
          $type=1.quark.String), $type=1.quark.String), Name(__add__),
        $type=1.quark.String.__add__), String("(...)", $type=1.quark.String),
       $type=1.quark.String)))),

    Method(static=False, Type(Name(String)), Name(_getClass), Block(
      Return(String("quark.behaviors.RPC", $type=1.quark.String)))),

    Method(static=False, Type(Name(Object)), Name(_getField),
     Param(Type(Name(String)), Name(name), $type=1.quark.String),
     Block(
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("service", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(service), $type=5.quark.Service)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("returned", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(returned), $type=3.quark.reflect.Class)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("timeout", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(timeout), $type=1.quark.float)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("methodName",
        $type=1.quark.String), $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(methodName), $type=1.quark.String)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("instance", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(instance), $type=5.quark.ServiceInstance)))),
      Return(Null(null, $type=1.quark.Object)))),

    Method(static=False, Type(Name(void)), Name(_setField),
     Param(Type(Name(String)), Name(name), $type=1.quark.String),
     Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
     Block(
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("service", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(service), $type=5.quark.Service), Cast(Var(Name(value),
          $type=1.quark.Object), $type=5.quark.Service)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("returned", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(returned), $type=3.quark.reflect.Class), Cast(Var(Name(value),
          $type=1.quark.Object), $type=3.quark.reflect.Class)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("timeout", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(timeout), $type=1.quark.float), Cast(Var(Name(value),
          $type=1.quark.Object), $type=1.quark.float)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("methodName",
        $type=1.quark.String), $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(methodName), $type=1.quark.String), Cast(Var(Name(value),
          $type=1.quark.Object), $type=1.quark.String)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("instance", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPC),
          Name(instance), $type=5.quark.ServiceInstance), Cast(Var(Name(value),
          $type=1.quark.Object), $type=5.quark.ServiceInstance)))))),
    Field(static=True, Type(Name(reflect), Name(Class)),
     Name(quark_behaviors_RPC_ref), Call(Attr(Var(Name(reflect),
       $type=3.quark.reflect), Name(__register__),
      $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
        $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
       Name(quark_behaviors_RPC_md), $type=3.quark.reflect.Class),
     $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

   Class(Name(RPCRequest), Type(Name(HTTPHandler)), Type(Name(concurrent),
     Name(TimeoutListener)),
    Field(static=False, Type(Name(RPC)), Name(rpc),
    $type=5.quark.behaviors.RPC),
    Field(static=False, Type(Name(concurrent), Name(Future)), Name(retval),
    $type=6.quark.concurrent.Future),
    Field(static=False, Type(Name(List), Type(Name(Object))), Name(args),
    $type=1.quark.List<1.quark.Object>),
    Field(static=False, Type(Name(concurrent), Name(Timeout)), Name(timeout),
    $type=6.quark.concurrent.Timeout),

    Constructor(Name(RPCRequest),
     Param(Type(Name(List), Type(Name(Object))), Name(args),
     $type=1.quark.List<1.quark.Object>),
     Param(Type(Name(RPC)), Name(rpc), $type=5.quark.behaviors.RPC),
     Block(
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
        Name(retval), $type=6.quark.concurrent.Future),
       Cast(Call(Attr(Attr(Var(Name(rpc), $type=5.quark.behaviors.RPC),
           Name(returned), $type=3.quark.reflect.Class), Name(construct),
         $type=3.quark.reflect.Class.construct), List(,
         $type=1.quark.List<1.quark.Object>), $type=1.quark.Object),
       $type=6.quark.concurrent.Future)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
        Name(args), $type=1.quark.List<1.quark.Object>), Var(Name(args),
       $type=1.quark.List<1.quark.Object>)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
        Name(timeout), $type=6.quark.concurrent.Timeout),
       Call(Type(Name(concurrent), Name(Timeout)), Attr(Var(Name(rpc),
         $type=5.quark.behaviors.RPC), Name(timeout), $type=1.quark.float),
       $type=6.quark.concurrent.Timeout)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
        Name(rpc), $type=5.quark.behaviors.RPC), Var(Name(rpc),
       $type=5.quark.behaviors.RPC)))),

    Method(static=False, Type(Name(concurrent), Name(Future)), Name(call),
     Param(Type(Name(HTTPRequest)), Name(request), $type=7.quark.HTTPRequest),
     Block(
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.RPCRequest), Name(timeout),
         $type=6.quark.concurrent.Timeout), Name(start),
        $type=6.quark.concurrent.Timeout.start), Var(Name(self),
        $type=5.quark.behaviors.RPCRequest), $type=1.quark.void)),
      ExprStmt(Call(Attr(Call(Attr(Attr(Var(Name(concurrent),
            $type=6.quark.concurrent), Name(Context),
           $type=6.quark.concurrent.Context), Name(runtime),
          $type=6.quark.concurrent.Context.runtime), $type=0.quark.Runtime),
         Name(request), $type=0.quark.Runtime.request), Var(Name(request),
        $type=7.quark.HTTPRequest), Var(Name(self),
        $type=5.quark.behaviors.RPCRequest), $type=1.quark.void)),
      Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
        Name(retval), $type=6.quark.concurrent.Future)))),

    Method(static=False, Type(Name(void)), Name(onHTTPResponse),
     Param(Type(Name(HTTPRequest)), Name(rq), $type=7.quark.HTTPRequest),
     Param(Type(Name(HTTPResponse)), Name(response),
     $type=7.quark.HTTPResponse),
     Block(
      Local(
       Declaration(Type(Name(String)), Name(info), $type=1.quark.String)),
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.RPCRequest), Name(timeout),
         $type=6.quark.concurrent.Timeout), Name(cancel),
        $type=6.quark.concurrent.Timeout.cancel), $type=1.quark.void)),
      If(Call(Attr(Call(Attr(Var(Name(response), $type=7.quark.HTTPResponse),
           Name(getCode), $type=7.quark.HTTPResponse.getCode),
         $type=1.quark.int), Name(__ne__), $type=1.quark.Object.__ne__),
        Number(200, $type=1.quark.int), $type=1.quark.bool), Block(
        Assign(Var(Name(info), $type=1.quark.String),
         Call(Attr(Call(Attr(Call(Attr(Attr(Var(Name(self),
                $type=5.quark.behaviors.RPCRequest), Name(rpc),
               $type=5.quark.behaviors.RPC), Name(toString),
              $type=5.quark.behaviors.RPC.toString), $type=1.quark.String),
             Name(__add__), $type=1.quark.String.__add__),
            String(" failed: Server returned error ", $type=1.quark.String),
           $type=1.quark.String), Name(__add__), $type=1.quark.String.__add__),
          Call(Attr(Call(Attr(Var(Name(response), $type=7.quark.HTTPResponse),
              Name(getCode), $type=7.quark.HTTPResponse.getCode),
            $type=1.quark.int), Name(toString), $type=1.quark.int.toString),
          $type=1.quark.String), $type=1.quark.String)),
        ExprStmt(Call(Attr(Attr(Var(Name(self),
            $type=5.quark.behaviors.RPCRequest), Name(retval),
           $type=6.quark.concurrent.Future), Name(finish),
          $type=6.quark.concurrent.Future.finish), Call(Var(Name(RPCError),
           $type=5.quark.behaviors.RPCError), Var(Name(info),
           $type=1.quark.String), $type=5.quark.behaviors.RPCError),
         $type=1.quark.void)),
        ExprStmt(Call(Attr(Attr(Var(Name(self),
            $type=5.quark.behaviors.RPCRequest), Name(rpc),
           $type=5.quark.behaviors.RPC), Name(fail),
          $type=5.quark.behaviors.RPC.fail), Var(Name(info),
          $type=1.quark.String), $type=1.quark.void)),
        Return())),
      Local(
       Declaration(Type(Name(String)), Name(body),
        Call(Attr(Var(Name(response), $type=7.quark.HTTPResponse),
          Name(getBody), $type=7.quark.HTTPResponse.getBody),
        $type=1.quark.String), $type=1.quark.String)),
      Local(
       Declaration(Type(Name(JSONObject)), Name(obj), Call(Attr(Var(Name(body),
          $type=1.quark.String), Name(parseJSON),
         $type=1.quark.String.parseJSON), $type=4.quark.JSONObject),
       $type=4.quark.JSONObject)),
      Local(
       Declaration(Type(Name(String)), Name(classname),
        Call(Attr(Var(Name(obj), $type=4.quark.JSONObject), Name(__get__),
         $type=4.quark.JSONObject.__get__), String("$class",
         $type=1.quark.String), $type=4.quark.JSONObject),
       $type=1.quark.String)),
      If(Call(Attr(Var(Name(classname), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), Null(null, $type=1.quark.Object),
       $type=1.quark.bool), Block(
        Assign(Var(Name(info), $type=1.quark.String),
         Call(Attr(Call(Attr(Attr(Var(Name(self),
              $type=5.quark.behaviors.RPCRequest), Name(rpc),
             $type=5.quark.behaviors.RPC), Name(toString),
            $type=5.quark.behaviors.RPC.toString), $type=1.quark.String),
           Name(__add__), $type=1.quark.String.__add__),
          String(" failed: Server returned unrecognizable content",
          $type=1.quark.String), $type=1.quark.String)),
        ExprStmt(Call(Attr(Attr(Var(Name(self),
            $type=5.quark.behaviors.RPCRequest), Name(retval),
           $type=6.quark.concurrent.Future), Name(finish),
          $type=6.quark.concurrent.Future.finish), Call(Var(Name(RPCError),
           $type=5.quark.behaviors.RPCError), Var(Name(info),
           $type=1.quark.String), $type=5.quark.behaviors.RPCError),
         $type=1.quark.void)),
        ExprStmt(Call(Attr(Attr(Var(Name(self),
            $type=5.quark.behaviors.RPCRequest), Name(rpc),
           $type=5.quark.behaviors.RPC), Name(fail),
          $type=5.quark.behaviors.RPC.fail), Var(Name(info),
          $type=1.quark.String), $type=1.quark.void)),
        Return()), Block(
        ExprStmt(Call(Var(Name(fromJSON), $type=4.quark.fromJSON),
          Attr(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
            Name(rpc), $type=5.quark.behaviors.RPC), Name(returned),
          $type=3.quark.reflect.Class), Attr(Var(Name(self),
           $type=5.quark.behaviors.RPCRequest), Name(retval),
          $type=6.quark.concurrent.Future), Var(Name(obj),
          $type=4.quark.JSONObject), $type=1.quark.Object)),
        ExprStmt(Call(Attr(Attr(Var(Name(self),
            $type=5.quark.behaviors.RPCRequest), Name(retval),
           $type=6.quark.concurrent.Future), Name(finish),
          $type=6.quark.concurrent.Future.finish), Null(null,
          $type=1.quark.Object), $type=1.quark.void)),
        ExprStmt(Call(Attr(Attr(Var(Name(self),
            $type=5.quark.behaviors.RPCRequest), Name(rpc),
           $type=5.quark.behaviors.RPC), Name(succeed),
          $type=5.quark.behaviors.RPC.succeed),
          String("Success in the future...", $type=1.quark.String),
         $type=1.quark.void)))))),

    Method(static=False, Type(Name(void)), Name(onTimeout),
     Param(Type(Name(concurrent), Name(Timeout)), Name(timeout),
     $type=6.quark.concurrent.Timeout),
     Block(
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.RPCRequest), Name(retval),
         $type=6.quark.concurrent.Future), Name(finish),
        $type=6.quark.concurrent.Future.finish), Call(Var(Name(RPCError),
         $type=5.quark.behaviors.RPCError), String("request timed out",
         $type=1.quark.String), $type=5.quark.behaviors.RPCError),
       $type=1.quark.void)),
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.RPCRequest), Name(rpc),
         $type=5.quark.behaviors.RPC), Name(fail),
        $type=5.quark.behaviors.RPC.fail), String("request timed out",
        $type=1.quark.String), $type=1.quark.void)))),

    Method(static=False, Type(Name(String)), Name(_getClass), Block(
      Return(String("quark.behaviors.RPCRequest", $type=1.quark.String)))),

    Method(static=False, Type(Name(Object)), Name(_getField),
     Param(Type(Name(String)), Name(name), $type=1.quark.String),
     Block(
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("rpc", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
          Name(rpc), $type=5.quark.behaviors.RPC)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("retval", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
          Name(retval), $type=6.quark.concurrent.Future)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("args", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
          Name(args), $type=1.quark.List<1.quark.Object>)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("timeout", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
          Name(timeout), $type=6.quark.concurrent.Timeout)))),
      Return(Null(null, $type=1.quark.Object)))),

    Method(static=False, Type(Name(void)), Name(_setField),
     Param(Type(Name(String)), Name(name), $type=1.quark.String),
     Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
     Block(
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("rpc", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
          Name(rpc), $type=5.quark.behaviors.RPC), Cast(Var(Name(value),
          $type=1.quark.Object), $type=5.quark.behaviors.RPC)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("retval", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
          Name(retval), $type=6.quark.concurrent.Future), Cast(Var(Name(value),
          $type=1.quark.Object), $type=6.quark.concurrent.Future)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("args", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
          Name(args), $type=1.quark.List<1.quark.Object>),
         Cast(Var(Name(value), $type=1.quark.Object),
         $type=1.quark.List<1.quark.Object>)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("timeout", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.RPCRequest),
          Name(timeout), $type=6.quark.concurrent.Timeout),
         Cast(Var(Name(value), $type=1.quark.Object),
         $type=6.quark.concurrent.Timeout)))))),
    Field(static=True, Type(Name(reflect), Name(Class)),
     Name(quark_behaviors_RPCRequest_ref), Call(Attr(Var(Name(reflect),
       $type=3.quark.reflect), Name(__register__),
      $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
        $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
       Name(quark_behaviors_RPCRequest_md), $type=3.quark.reflect.Class),
     $type=3.quark.reflect.Class), $type=3.quark.reflect.Class)),

   Class(Name(CircuitBreaker), Type(Name(Task)),
    Field(static=False, Type(Name(String)), Name(id), $type=1.quark.String),
    Field(static=False, Type(Name(int)), Name(failureLimit),
    $type=1.quark.int),
    Field(static=False, Type(Name(float)), Name(retestDelay),
    $type=1.quark.float),
    Field(static=False, Type(Name(bool)), Name(active), Bool(true,
     $type=1.quark.bool), $type=1.quark.bool),
    Field(static=False, Type(Name(int)), Name(failureCount), Number(0,
     $type=1.quark.int), $type=1.quark.int),
    Field(static=False, Type(Name(concurrent), Name(Lock)), Name(mutex),
     Call(Type(Name(concurrent), Name(Lock)), $type=6.quark.concurrent.Lock),
    $type=6.quark.concurrent.Lock),

    Constructor(Name(CircuitBreaker),
     Param(Type(Name(String)), Name(id), $type=1.quark.String),
     Param(Type(Name(int)), Name(failureLimit), $type=1.quark.int),
     Param(Type(Name(float)), Name(retestDelay), $type=1.quark.float),
     Block(
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
        Name(id), $type=1.quark.String), Var(Name(id), $type=1.quark.String)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
        Name(failureLimit), $type=1.quark.int), Var(Name(failureLimit),
       $type=1.quark.int)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
        Name(retestDelay), $type=1.quark.float), Var(Name(retestDelay),
       $type=1.quark.float)))),

    Method(static=False, Type(Name(void)), Name(succeed), Block(
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(mutex),
         $type=6.quark.concurrent.Lock), Name(acquire),
        $type=6.quark.concurrent.Mutex.acquire), $type=1.quark.void)),
      If(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(failureCount),
         $type=1.quark.int), Name(__gt__), $type=1.quark.numeric.__gt__),
        Number(0, $type=1.quark.int), $type=1.quark.bool), Block(
        ExprStmt(Call(Attr(Attr(Var(Name(Client), $type=5.quark.Client),
            Name(logger), $type=2.quark.Logger), Name(info),
          $type=2.quark.Logger.info), Call(Attr(String("- CLOSE breaker on ",
            $type=1.quark.String), Name(__add__),
           $type=1.quark.String.__add__), Attr(Var(Name(self),
            $type=5.quark.behaviors.CircuitBreaker), Name(id),
           $type=1.quark.String), $type=1.quark.String),
         $type=1.quark.void)))),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
        Name(failureCount), $type=1.quark.int), Number(0, $type=1.quark.int)),
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(mutex),
         $type=6.quark.concurrent.Lock), Name(release),
        $type=6.quark.concurrent.Mutex.release), $type=1.quark.void)))),

    Method(static=False, Type(Name(void)), Name(fail), Block(
      Local(
       Declaration(Type(Name(bool)), Name(doSchedule), Bool(false,
        $type=1.quark.bool), $type=1.quark.bool)),
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(mutex),
         $type=6.quark.concurrent.Lock), Name(acquire),
        $type=6.quark.concurrent.Mutex.acquire), $type=1.quark.void)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
        Name(failureCount), $type=1.quark.int), Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(failureCount),
         $type=1.quark.int), Name(__add__), $type=1.quark.numeric.__add__),
        Number(1, $type=1.quark.int), $type=1.quark.int)),
      If(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(failureCount),
         $type=1.quark.int), Name(__ge__), $type=1.quark.numeric.__ge__),
        Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
         Name(failureLimit), $type=1.quark.int), $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(active), $type=1.quark.bool), Bool(false, $type=1.quark.bool)),
        Assign(Var(Name(doSchedule), $type=1.quark.bool), Bool(true,
         $type=1.quark.bool)),
        ExprStmt(Call(Attr(Attr(Var(Name(Client), $type=5.quark.Client),
            Name(logger), $type=2.quark.Logger), Name(warn),
          $type=2.quark.Logger.warn), Call(Attr(String("- OPEN breaker on ",
            $type=1.quark.String), Name(__add__),
           $type=1.quark.String.__add__), Attr(Var(Name(self),
            $type=5.quark.behaviors.CircuitBreaker), Name(id),
           $type=1.quark.String), $type=1.quark.String),
         $type=1.quark.void)))),
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(mutex),
         $type=6.quark.concurrent.Lock), Name(release),
        $type=6.quark.concurrent.Mutex.release), $type=1.quark.void)),
      If(Var(Name(doSchedule), $type=1.quark.bool), Block(
        ExprStmt(Call(Attr(Call(Attr(Attr(Var(Name(concurrent),
              $type=6.quark.concurrent), Name(Context),
             $type=6.quark.concurrent.Context), Name(runtime),
            $type=6.quark.concurrent.Context.runtime), $type=0.quark.Runtime),
           Name(schedule), $type=0.quark.Runtime.schedule), Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Attr(Var(Name(self),
           $type=5.quark.behaviors.CircuitBreaker), Name(retestDelay),
          $type=1.quark.float), $type=1.quark.void)))))),

    Method(static=False, Type(Name(void)), Name(onExecute),
     Param(Type(Name(Runtime)), Name(runtime), $type=0.quark.Runtime),
     Block(
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(mutex),
         $type=6.quark.concurrent.Lock), Name(acquire),
        $type=6.quark.concurrent.Mutex.acquire), $type=1.quark.void)),
      Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
        Name(active), $type=1.quark.bool), Bool(true, $type=1.quark.bool)),
      ExprStmt(Call(Attr(Attr(Var(Name(Client), $type=5.quark.Client),
          Name(logger), $type=2.quark.Logger), Name(warn),
        $type=2.quark.Logger.warn), Call(Attr(String("- RETEST breaker on ",
          $type=1.quark.String), Name(__add__), $type=1.quark.String.__add__),
         Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(id), $type=1.quark.String), $type=1.quark.String),
       $type=1.quark.void)),
      ExprStmt(Call(Attr(Attr(Var(Name(self),
          $type=5.quark.behaviors.CircuitBreaker), Name(mutex),
         $type=6.quark.concurrent.Lock), Name(release),
        $type=6.quark.concurrent.Mutex.release), $type=1.quark.void)))),

    Method(static=False, Type(Name(String)), Name(_getClass), Block(
      Return(String("quark.behaviors.CircuitBreaker", $type=1.quark.String)))),

    Method(static=False, Type(Name(Object)), Name(_getField),
     Param(Type(Name(String)), Name(name), $type=1.quark.String),
     Block(
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("id", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(id), $type=1.quark.String)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("failureLimit",
        $type=1.quark.String), $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(failureLimit), $type=1.quark.int)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("retestDelay",
        $type=1.quark.String), $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(retestDelay), $type=1.quark.float)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("active", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(active), $type=1.quark.bool)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("failureCount",
        $type=1.quark.String), $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(failureCount), $type=1.quark.int)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("mutex", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Return(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(mutex), $type=6.quark.concurrent.Lock)))),
      Return(Null(null, $type=1.quark.Object)))),

    Method(static=False, Type(Name(void)), Name(_setField),
     Param(Type(Name(String)), Name(name), $type=1.quark.String),
     Param(Type(Name(Object)), Name(value), $type=1.quark.Object),
     Block(
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("id", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(id), $type=1.quark.String), Cast(Var(Name(value),
          $type=1.quark.Object), $type=1.quark.String)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("failureLimit",
        $type=1.quark.String), $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(failureLimit), $type=1.quark.int), Cast(Var(Name(value),
          $type=1.quark.Object), $type=1.quark.int)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("retestDelay",
        $type=1.quark.String), $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(retestDelay), $type=1.quark.float), Cast(Var(Name(value),
          $type=1.quark.Object), $type=1.quark.float)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("active", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(active), $type=1.quark.bool), Cast(Var(Name(value),
          $type=1.quark.Object), $type=1.quark.bool)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("failureCount",
        $type=1.quark.String), $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(failureCount), $type=1.quark.int), Cast(Var(Name(value),
          $type=1.quark.Object), $type=1.quark.int)))),
      If(Call(Attr(Var(Name(name), $type=1.quark.String), Name(__eq__),
        $type=1.quark.Object.__eq__), String("mutex", $type=1.quark.String),
       $type=1.quark.bool), Block(
        Assign(Attr(Var(Name(self), $type=5.quark.behaviors.CircuitBreaker),
          Name(mutex), $type=6.quark.concurrent.Lock), Cast(Var(Name(value),
          $type=1.quark.Object), $type=6.quark.concurrent.Lock)))))),
    Field(static=True, Type(Name(reflect), Name(Class)),
     Name(quark_behaviors_CircuitBreaker_ref), Call(Attr(Var(Name(reflect),
       $type=3.quark.reflect), Name(__register__),
      $type=3.quark.reflect.__register__), Attr(Attr(Var(Name(quark_md),
        $type=16.quark_md), Name(Root), $type=16.quark_md.Root),
       Name(quark_behaviors_CircuitBreaker_md), $type=3.quark.reflect.Class),
     $type=3.quark.reflect.Class), $type=3.quark.reflect.Class))))
)